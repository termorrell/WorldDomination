var RiskMap={line:null,scale:1,enabled:!1,moving:!1,sourceTerritory:null,destinationTerritory:null,init:function(){function r(){var r=d3.mouse(this);map.attr("transform","translate("+r[0]+","+r[1]+")"),vis.on("mousemove",t)}function t(){var r=d3.mouse(this);map.attr("transform","translate("+r[0]+","+r[1]+")")}function i(){map.on("mousemove",null)}},claimTerritory:function(r){this.setActive(!0),$("#map").on("click",".territory",function(){var t=Territories[$(this).attr("id")];null!=t.player?RiskLog.addEntry("Please chose an unclaimed territory"):($("#map").off("click"),RiskMap.setActive(!1),RiskMap.updateTerritory(t,RiskGame.currentPlayer,t.armies+1),r(t.id))})},distributeArmy:function(r){this.setActive(!0),$("#map").on("click",".territory",function(){var t=Territories[$(this).attr("id")];t.player!=RiskGame.currentPlayer?RiskLog.addEntry("Please chose a territory you occupy"):($("#map").off("click"),RiskMap.setActive(!1),RiskMap.updateTerritory(t,t.player,t.armies+1),r(t.id))})},update:function(r){var t=$.parseJSON(r);t&&$.each(t.Territories,function(r,t){var i=null;$.each(Territories,function(r,e){e.id==t.territoryID&&(i=e)});var e=null;e=$.grep(Players,function(r){return r.id==t.playerId?r:void 0})[0],RiskMap.updateTerritory(i,e,t.armies)})},reinforce:function(r,t){var i=[],e=r;this.setActive(!0),$("#map").on("click",".territory",function(){var r=Territories[$(this).attr("id")];r.player!=RiskGame.currentPlayer?RiskLog.addEntry("Please chose a territory you occupy"):($(this).attr("class","territory selected"),e--,i.push(r.id),RiskMap.updateTerritory(r,r.player,r.armies+1),0==e&&($("#map").off("click"),$(".territory").attr("class","territory"),RiskMap.setActive(!1),t(i)))})},makeTurn:function(){var r=2;this.setActive(!0),$("#map").on("click",".territory",function(){2==r?(RiskMap.sourceTerritory=this,r--):1==r?(RiskMap.destinationTerritory=this,r--):($(RiskMap.sourceTerritory).attr("class","territory"),RiskMap.sourceTerritory=RiskMap.destinationTerritory,RiskMap.destinationTerritory=this),$(this).attr("class","territory selected")})},setActive:function(r){r?$("#territories").attr("class","active"):$("#territories").attr("class","")},updateTerritory:function(r,t,i){return null==t&&null==i?(this.setPlayer(r,t),void this.setArmies(r,i)):void(null!=r.player?(r.player.id!=t.id&&this.setPlayer(r,t),r.armies!=i&&this.setArmies(r,i)):(this.setPlayer(r,t),this.setArmies(r,i)))},setPlayer:function(r,t){t&&(r.player=t,$(r.domID).find(".army").attr("class","army swing"),setTimeout(function(){$(r.domID).find(".army").attr("class","army")},1200),$(r.domID).find(".army path").attr("stroke",t.color))},setArmies:function(r,t){t&&(r.armies=t,$(r.domID).find(".army").attr("class","army swing"),setTimeout(function(){$(r.domID).find(".army").attr("class","army")},1200),$(r.domID).find(".army text").text(r.armies))},zoomMap:function(r){this.scale+=r}};