var RiskGame={currentPlayer:null,init:function(){var e=new AssetManager;e.add("joinGameIcon","img/users2.svg"),e.add("hostGameIcon","img/wireless12.svg"),e.add("removeIcon","img/arrows_remove.svg"),e.add("removeIcon","img/trophy60.svg"),e.add("removeIcon","img/warning38.svg"),e.add("removeIcon","img/arrow413.png"),$.each(Territories,function(t,i){e.add("removeIcon","img/territories/"+i.svg)}),e.downloadAll(function(){RiskMap.init(),setNeighbouringTerritories(),RiskLog.init(),RiskGame.showContent(),setTimeout(function(){RiskGame.removeLoader()},280)})},showContent:function(){$(".content-container").delay(300).fadeTo(400,1),$("#nav-buttons").delay(300).fadeTo(400,1)},showMap:function(){$("#map").removeClass("blur"),$(".main-content .overlay").fadeOut(),RiskLog.show(),this.allowPlayerNameHover(),this.hideMapActivityIndicator(),$("#joinGame").fadeOut()},hideMap:function(){$("#map").addClass("blur"),$(".main-content .overlay").fadeIn(),RiskLog.hide(),this.showMapActivityIndicator(),$("#joinGame").fadeIn()},allowPlayerNameHover:function(){$(".names").on("mouseover","tr",function(){$(this).css("background","#eee");var e=Players[this.rowIndex-1];$.each(Territories,function(t,i){i.player===e&&$(i.domID).attr("class","territory selected")})}),$(".names").on("mouseout","tr",function(){$(this).css("background","#fff"),$(".territory").attr("class","territory")})},showTurnControls:function(){$(".turnControls").fadeIn()},hideTurnControls:function(){$(".turnControls").fadeOut()},showInitialiseModal:function(){$(".initialiseModal").fadeIn()},hideInitialiseModal:function(){$(".initialiseModal").fadeOut()},showHostAndPlayModal:function(){$(".hostAndPlayModal").fadeIn()},hideHostAndPlayModal:function(){$(".hostAndPlayModal").fadeOut()},removeLoader:function(){this.hideInitialActivityIndicator()},hideNoPlayersText:function(){$("p#noPlayersText").fadeOut()},hideJoinGameButton:function(){$("button#joinGame").fadeOut()},showLeaveGameButton:function(){$("button#leaveGame").fadeIn()},hideContinueButton:function(){$("#continue").fadeOut()},showContinueButton:function(){$("#continue").fadeIn()},showInitialActivityIndicator:function(){$("#initialActivityIndicator").fadeIn()},hideInitialActivityIndicator:function(){$("#initialActivityIndicator").fadeOut()},showMapActivityIndicator:function(){$("#mapActivityIndicator").fadeIn()},hideMapActivityIndicator:function(){$("#mapActivityIndicator").fadeOut()},showLeaveGame:function(){$(".leaveGame").fadeIn()},hideLeaveGame:function(){$(".leaveGame").fadeOut()},showAlert:function(e){$(".alert").fadeIn(),$(".alert p").text(e)},hideLeaveGame:function(){$(".alert").fadeOut(function(){$(".alert p").text(""),location.reload()})},showNoConnection:function(){$(".noConnection").fadeIn()},hideNoConnection:function(){$(".noConnection").fadeOut()},showAutoDismissError:function(e){$(".modal.error").fadeIn(),$(".modal.error p").text(e),setTimeout(function(){RiskGame.hideAutoDismissError()},500)},hideAutoDismissError:function(){$(".modal.error").fadeOut()},showGameOver:function(){$(".gameOver").fadeIn()},hideGameOver:function(){$(".gameOver").fadeOut()},showAllocateArmies:function(){$("#turnNumber").val(1),$(".allocateArmies").fadeIn()},hideAllocateArmies:function(){$(".allocateArmies").fadeOut()},showCompleteTurn:function(){$("#turnNumber").val(1),$(".completeTurn").fadeIn()},hideCompleteTurn:function(){$(".completeTurn").fadeOut()},setCardsEnabled:function(){function e(){$(".cards").off("click"),$(".cards-close .close").fadeIn(),$(".cards-close .close").on("click",function(){t()}),$(".cards").addClass("display"),$(".cards").on("click",".card",function(){var e=!1,n=$(this).data("territoryID");$.each(i,function(t,i){var a=$(i).data("territoryID");a===n&&(e=!0)}),e||($(this).addClass("selected"),i.push(this),3===i.length&&($(i).remove(),$.each(i,function(e,t){var i=$(t).data("territoryID"),n;$.each(Cards,function(e,t){i===t.territoryID&&(n=e)}),Cards.splice(n,1)}),i=[]),0===Cards.length&&t())})}function t(){$(".cards").off("click"),$(".cards .card").removeClass("selected"),$(".cards-close .close").fadeOut(),$(".cards-close .close").off("click"),$(".cards").removeClass("display"),$(".cards").on("click",function(){Cards.length>0&&e()})}var i=[];$(".cards").on("click",function(){Cards.length>0&&e()})},setTimer:function(e){var t=new Date(e),i=new Date,n=t.getTime()-i.getTime();$(".timer").fadeIn(),$(".timer").animate({width:"100%"},n,function(){$(".timer").css({display:"none",width:"100%"})})},initialiseGame:function(){this.hideNoPlayersText(),this.hideJoinGameButton(),this.showLeaveGameButton()},waitForReadyState:function(){this.showMapActivityIndicator()},ready:function(){this.hideMapActivityIndicator(),this.setCardsEnabled()},joinGame:function(){this.initialiseGame(!0),this.hideInitialiseModal();var e=$("#ipAddressInput").val(),t=parseInt($("#portNumberInput").val());window.joinGame(e,t)},hostGame:function(){this.showHostAndPlayModal(),this.hideInitialiseModal()},hostGameOnly:function(){this.initialiseGame(),this.hideHostAndPlayModal(),this.waitForReadyState(),window.hostGame(!1)},hostAndJoinGame:function(){this.initialiseGame(!0),this.hideHostAndPlayModal(),window.hostGame(!0)},clearPlayers:function(){Players=[]},addPlayer:function(e,t,i,n){Players.push(new Player(e,t,i,n))},setMapEnabled:function(e){RiskMap.enabled=e},currentPlayerEvent:function(e,t){this.setMapEnabled(t?!0:!1),this.currentPlayer=$.grep(Players,function(t){return t.id===e?t:void 0})[0]},rejectionEvent:function(e){this.showAlert(e)},claimTerritoryEvent:function(e){RiskMap.claimTerritory(e)},distributeArmyEvent:function(e){RiskMap.distributeArmy(e)},mapUpdateEvent:function(e){RiskMap.update(e)},reinforceEvent:function(e,t){RiskMap.reinforce(e,t)},makeTurnEvent:function(e,t){function i(){RiskMap.setActive(!1),$(".territory").attr("class","territory"),$("#map").off("click"),$("button#makeTurn").off("click"),$("button#finishTurn").off("click"),RiskGame.hideTurnControls()}function n(){$(".territory").attr("class","territory"),$("#map").off("click"),RiskMap.makeTurn()}RiskMap.sourceTerritory=null,RiskMap.destinationTerritory=null,RiskMap.makeTurn(),this.showTurnControls(),this.setTimer(e),$("button#makeTurn").on("click",function(){var e=[];if(RiskMap.sourceTerritory&&e.push($(RiskMap.sourceTerritory).attr("id")),RiskMap.destinationTerritory&&e.push($(RiskMap.destinationTerritory).attr("id")),2===e.length){var a=Territories[$(RiskMap.sourceTerritory).attr("id")],o=Territories[$(RiskMap.destinationTerritory).attr("id")],r;if(a.player!==RiskGame.currentPlayer)return n(),void RiskLog.addEntry("You need to choose your own territory as the source");var s=!1;if($.each(a.neighbours,function(e,t){t.id==o.id&&(s=!0)}),!s)return n(),void RiskLog.addEntry("You need to choose a neighbouring territory as the source");if(r=o.player===RiskGame.currentPlayer?!1:!0,a.armies<2)return n(),void RiskLog.addEntry("You need at least 2 armies in the source territory");i();var c;r?(c=a.armies-1,c>3&&(c=3)):c=a.armies-1,RiskGame.completeTurn(a.id,o.id,c,function(e){var i=r?"Attack":"Fortify";t(i,a.id,o.id,e)})}else RiskLog.addEntry("Please make a legal move")}),$("button#finishTurn").on("click",function(){i(),t("Quit",null,null,null)})},completeTurn:function(e,t,i,n){this.showCompleteTurn();var a,o;$.each(Territories,function(i,n){n.id===e?a=n.svg:n.id===t&&(o=n.svg)}),$(".completeTurn img#turnSource").attr("src","img/territories/"+a),$(".completeTurn img#turnDestination").attr("src","img/territories/"+o),$("#turnNumber").attr("max",i),$("#completeTurn").on("click",function(){$("#completeTurn").off("click"),RiskGame.hideCompleteTurn();var e=$("#turnNumber").val();n(e)})},allocateCardEvent:function(e,t){var i=new Card(e,t);Cards.push(i);var n,a;$.each(Territories,function(t,i){i.id===e&&(n=i.svg,a=t+"Card")});var o=$(".cards").append('<div class="card"><h5>'+i.type+'</h5><img src="img/territories/'+n+'"></div>');o.children().last().data("card",a),o.children().last().data("territoryID",e)},allocateArmiesEvent:function(e,t,i,n){this.showAllocateArmies();var a,o;$.each(Territories,function(i,n){n.id===e?a=n.svg:n.id===t&&(o=n.svg)}),$(".allocateArmies img#allocateSource").attr("src","img/territories/"+a),$(".allocateArmies img#allocateDestination").attr("src","img/territories/"+o),$("#allocateNumer").attr("max",i),$("#allocateArmies").on("click",function(){$("#allocateArmies").off("click"),RiskGame.hideAllocateArmies();var e=$("#allocateNumer").val();n(e)})},winnerEvent:function(e){$.each(e,function(e,t){$(".players").append("<li>"+t.name_0+"</li>")}),this.showGameOver()}};