var RiskGame={currentPlayer:null,init:function(){var t=new AssetManager;t.add("joinGameIcon","img/users2.svg"),t.add("hostGameIcon","img/wireless12.svg"),t.add("removeIcon","img/arrows_remove.svg"),t.add("removeIcon","img/trophy60.svg"),t.add("removeIcon","img/warning38.svg"),t.add("removeIcon","img/arrow413.png"),$.each(Territories,function(e,i){t.add("removeIcon","img/territories/"+i.svg)}),t.downloadAll(function(){RiskMap.init(),setNeighbouringTerritories(),RiskLog.init(),RiskGame.showContent(),setTimeout(function(){RiskGame.removeLoader()},280)})},showContent:function(){$(".content-container").delay(300).fadeTo(400,1),$("#nav-buttons").delay(300).fadeTo(400,1)},showMap:function(){$("#map").removeClass("blur"),$(".main-content .overlay").fadeOut(),RiskLog.show(),this.allowPlayerNameHover(),this.hideMapActivityIndicator(),$("#joinGame").fadeOut()},hideMap:function(){$("#map").addClass("blur"),$(".main-content .overlay").fadeIn(),RiskLog.hide(),this.showMapActivityIndicator(),$("#joinGame").fadeIn()},allowPlayerNameHover:function(){$(".names").on("mouseover","tr",function(){$(this).css("background","#eee");var t=Players[this.rowIndex-1];$.each(Territories,function(e,i){i.player===t&&$(i.domID).attr("class","territory selected")})}),$(".names").on("mouseout","tr",function(){$(this).css("background","#fff"),$(".territory").attr("class","territory")})},showTurnControls:function(){$(".turnControls").fadeIn()},hideTurnControls:function(){$(".turnControls").fadeOut()},showInitialiseModal:function(){$(".initialiseModal").fadeIn()},hideInitialiseModal:function(){$(".initialiseModal").fadeOut()},showHostAndPlayModal:function(){$(".hostAndPlayModal").fadeIn()},hideHostAndPlayModal:function(){$(".hostAndPlayModal").fadeOut()},removeLoader:function(){this.hideInitialActivityIndicator()},hideNoPlayersText:function(){$("p#noPlayersText").fadeOut()},hideJoinGameButton:function(){$("button#joinGame").fadeOut()},showLeaveGameButton:function(){$("button#leaveGame").fadeIn()},hideContinueButton:function(){$("#continue").fadeOut()},showContinueButton:function(){$("#continue").fadeIn()},showInitialActivityIndicator:function(){$("#initialActivityIndicator").fadeIn()},hideInitialActivityIndicator:function(){$("#initialActivityIndicator").fadeOut()},showMapActivityIndicator:function(){$("#mapActivityIndicator").fadeIn()},hideMapActivityIndicator:function(){$("#mapActivityIndicator").fadeOut()},showLeaveGame:function(){$(".leaveGame").fadeIn()},hideLeaveGame:function(){$(".leaveGame").fadeOut()},showAlert:function(t){$(".alert").fadeIn(),$(".alert p").text(t)},hideLeaveGame:function(){$(".alert").fadeOut(function(){$(".alert p").text(""),location.reload()})},showNoConnection:function(){$(".noConnection").fadeIn()},hideNoConnection:function(){$(".noConnection").fadeOut()},showAutoDismissError:function(t){$(".modal.error").fadeIn(),$(".modal.error p").text(t),setTimeout(function(){RiskGame.hideAutoDismissError()},500)},hideAutoDismissError:function(){$(".modal.error").fadeOut()},showGameOver:function(){$(".gameOver").fadeIn()},hideGameOver:function(){$(".gameOver").fadeOut()},showAllocateArmies:function(){$("#turnNumber").val(1),$(".allocateArmies").fadeIn()},hideAllocateArmies:function(){$(".allocateArmies").fadeOut()},showCompleteTurn:function(){$("#turnNumber").val(1),$(".completeTurn").fadeIn()},hideCompleteTurn:function(){$(".completeTurn").fadeOut()},setCardsEnabled:function(){function t(){$(".cards").off("click"),$(".cards-close .close").fadeIn(),$(".cards-close .close").on("click",function(){e()}),$(".cards").addClass("display"),$(".cards").on("click",".card",function(){var t=!1,n=$(this).data("territoryID");$.each(i,function(e,i){var a=$(i).data("territoryID");a===n&&(t=!0)}),t||($(this).addClass("selected"),i.push(this),3===i.length&&($(i).remove(),$.each(i,function(t,e){var i=$(e).data("territoryID"),n;$.each(Cards,function(t,e){i===e.territoryID&&(n=t)}),Cards.splice(n,1)}),i=[]),0===Cards.length&&e())})}function e(){$(".cards").off("click"),$(".cards .card").removeClass("selected"),$(".cards-close .close").fadeOut(),$(".cards-close .close").off("click"),$(".cards").removeClass("display"),$(".cards").on("click",function(){Cards.length>0&&t()})}var i=[];$(".cards").on("click",function(){Cards.length>0&&t()})},setTimer:function(t){var e=new Date(t),i=new Date,n=e.getTime()-i.getTime();$(".timer").fadeIn(),$(".timer").animate({width:"100%"},n,function(){$(".timer").css({display:"none",width:"100%"})})},initialiseGame:function(){this.hideNoPlayersText(),this.hideJoinGameButton(),this.showLeaveGameButton()},waitForReadyState:function(){this.showMapActivityIndicator()},ready:function(){this.hideMapActivityIndicator(),this.setCardsEnabled()},joinGame:function(){this.initialiseGame(!0),this.hideInitialiseModal();var t=$("#ipAddressInput").val(),e=parseInt($("#portNumberInput").val());window.joinGame(t,e)},hostGame:function(){this.showHostAndPlayModal(),this.hideInitialiseModal()},hostGameOnly:function(){this.initialiseGame(),this.hideHostAndPlayModal(),this.waitForReadyState(),window.hostGame(!1)},hostAndJoinGame:function(){this.initialiseGame(!0),this.hideHostAndPlayModal(),window.hostGame(!0)},clearPlayers:function(){Players=[]},addPlayer:function(t,e,i,n){Players.push(new Player(t,e,i,n))},setMapEnabled:function(t){RiskMap.enabled=t},currentPlayerEvent:function(t,e){this.setMapEnabled(e?!0:!1),this.currentPlayer=$.grep(Players,function(e){return e.id===t?e:void 0})[0]},rejectionEvent:function(t){this.showAlert(t)},claimTerritoryEvent:function(t){RiskMap.claimTerritory(t)},distributeArmyEvent:function(t){RiskMap.distributeArmy(t)},mapUpdateEvent:function(t){RiskMap.update(t)},reinforceEvent:function(t,e){RiskMap.reinforce(t,e)},makeTurnEvent:function(t,e){function i(){RiskMap.setActive(!1),$(".territory").attr("class","territory"),$("#map").off("click"),$("button#makeTurn").off("click"),$("button#finishTurn").off("click"),RiskGame.hideTurnControls()}function n(){$(".territory").attr("class","territory"),$("#map").off("click"),RiskMap.makeTurn()}RiskMap.sourceTerritory=null,RiskMap.destinationTerritory=null,RiskMap.makeTurn(),this.showTurnControls(),this.setTimer(t),$("button#makeTurn").on("click",function(){var t=[];if(RiskMap.sourceTerritory&&t.push($(RiskMap.sourceTerritory).attr("id")),RiskMap.destinationTerritory&&t.push($(RiskMap.destinationTerritory).attr("id")),2===t.length){var a=Territories[$(RiskMap.sourceTerritory).attr("id")],o=Territories[$(RiskMap.destinationTerritory).attr("id")],r;if(a.player!==RiskGame.currentPlayer)return n(),void RiskLog.addEntry("You need to choose your own territory as the source");if(r=o.player===RiskGame.currentPlayer?!1:!0,a.armies<2)return n(),void RiskLog.addEntry("You need at least 2 armies in the source territory");i();var s;r?(s=a.armies-1,s>3&&(s=3)):s=a.armies-1,RiskGame.completeTurn(a.id,o.id,s,function(t){var i=r?"Attack":"Fortify";e(i,a.id,o.id,t)})}else RiskLog.addEntry("Please make a legal move")}),$("button#finishTurn").on("click",function(){i(),e("Quit",null,null,null)})},completeTurn:function(t,e,i,n){this.showCompleteTurn();var a,o;$.each(Territories,function(i,n){n.id===t?a=n.svg:n.id===e&&(o=n.svg)}),$(".completeTurn img#turnSource").attr("src","img/territories/"+a),$(".completeTurn img#turnDestination").attr("src","img/territories/"+o),$("#turnNumber").attr("max",i),$("#completeTurn").on("click",function(){$("#completeTurn").off("click"),RiskGame.hideCompleteTurn();var t=$("#turnNumber").val();n(t)})},allocateCardEvent:function(t,e){var i=new Card(t,e);Cards.push(i);var n,a;$.each(Territories,function(e,i){i.id===t&&(n=i.svg,a=e+"Card")});var o=$(".cards").append('<div class="card"><h5>'+i.type+'</h5><img src="img/territories/'+n+'"></div>');o.children().last().data("card",a),o.children().last().data("territoryID",t)},allocateArmiesEvent:function(t,e,i,n){this.showAllocateArmies();var a,o;$.each(Territories,function(i,n){n.id===t?a=n.svg:n.id===e&&(o=n.svg)}),$(".allocateArmies img#allocateSource").attr("src","img/territories/"+a),$(".allocateArmies img#allocateDestination").attr("src","img/territories/"+o),$("#allocateNumer").attr("max",i),$("#allocateArmies").on("click",function(){$("#allocateArmies").off("click"),RiskGame.hideAllocateArmies();var t=$("#allocateNumer").val();n(t)})},winnerEvent:function(t){$.each(t,function(t,e){$(".players").append("<li>"+e.name_0+"</li>")}),this.showGameOver()}};