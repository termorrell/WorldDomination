var RiskGame={currentPlayer:null,arrayOfSelectedCards:[],init:function(){var e=new AssetManager;e.add("joinGameIcon","img/users2.svg"),e.add("hostGameIcon","img/wireless12.svg"),e.add("removeIcon","img/arrows_remove.svg"),e.add("removeIcon","img/trophy60.svg"),e.add("removeIcon","img/warning38.svg"),e.add("removeIcon","img/arrow413.png"),$.each(Territories,function(i,t){e.add("removeIcon","img/territories/"+t.svg)}),e.downloadAll(function(){RiskMap.init(),setNeighbouringTerritories(),RiskLog.init(),RiskGame.showContent(),setTimeout(function(){RiskGame.removeLoader()},280)})},showContent:function(){$(".content-container").delay(300).fadeTo(400,1),$("#nav-buttons").delay(300).fadeTo(400,1)},showMap:function(){$("#map").removeClass("blur"),$(".main-content .overlay").fadeOut(),RiskLog.show(),this.allowPlayerNameHover(),this.hideMapActivityIndicator(),$("#joinGame").fadeOut()},hideMap:function(){$("#map").addClass("blur"),$(".main-content .overlay").fadeIn(),RiskLog.hide(),this.showMapActivityIndicator(),$("#joinGame").fadeIn()},allowPlayerNameHover:function(){$(".names").on("mouseover","tr",function(){$(this).css("background","#eee");var e=Players[this.rowIndex-1];$.each(Territories,function(i,t){t.player===e&&$(t.domID).attr("class","territory selected")})}),$(".names").on("mouseout","tr",function(){$(this).css("background","#fff"),$(".territory").attr("class","territory")})},showTurnControls:function(){$(".turnControls").fadeIn()},hideTurnControls:function(){$(".turnControls").fadeOut()},showInitialiseModal:function(){$(".initialiseModal").fadeIn()},hideInitialiseModal:function(){$(".initialiseModal").fadeOut()},showHostAndPlayModal:function(){$(".hostAndPlayModal").fadeIn()},hideHostAndPlayModal:function(){$(".hostAndPlayModal").fadeOut()},removeLoader:function(){this.hideInitialActivityIndicator()},hideNoPlayersText:function(){$("p#noPlayersText").fadeOut()},hideJoinGameButton:function(){$("button#joinGame").fadeOut()},showLeaveGameButton:function(){$("button#leaveGame").fadeIn()},hideContinueButton:function(){$("#continue").fadeOut()},showContinueButton:function(){$("#continue").fadeIn()},showInitialActivityIndicator:function(){$("#initialActivityIndicator").fadeIn()},hideInitialActivityIndicator:function(){$("#initialActivityIndicator").fadeOut()},showMapActivityIndicator:function(){$("#mapActivityIndicator").fadeIn()},hideMapActivityIndicator:function(){$("#mapActivityIndicator").fadeOut()},showLeaveGame:function(){$(".leaveGame").fadeIn()},hideLeaveGame:function(){$(".leaveGame").fadeOut()},showAlert:function(e){$(".alert").fadeIn(),$(".alert p").text(e)},hideLeaveGame:function(){$(".alert").fadeOut(function(){$(".alert p").text(""),location.reload()})},showNoConnection:function(){$(".noConnection").fadeIn()},hideNoConnection:function(){$(".noConnection").fadeOut()},showAutoDismissError:function(e){$(".modal.error").fadeIn(),$(".modal.error p").text(e),setTimeout(function(){RiskGame.hideAutoDismissError()},500)},hideAutoDismissError:function(){$(".modal.error").fadeOut()},showGameOver:function(){$(".gameOver").fadeIn()},hideGameOver:function(){$(".gameOver").fadeOut()},showDefendTerritory:function(){$("#defendNumber").val(1),$(".defendTerritory").fadeIn()},hideDefendTerritory:function(){$(".defendTerritory").fadeOut()},showAllocateArmies:function(){$("#allocateNumber").val(1),$(".allocateArmies").fadeIn()},hideAllocateArmies:function(){$(".allocateArmies").fadeOut()},showCompleteTurn:function(){$("#turnNumber").val(1),$(".completeTurn").fadeIn()},hideCompleteTurn:function(){$(".completeTurn").fadeOut()},setCardsEnabled:function(e,i){this.arrayOfSelectedCards=[],$(".cards").off("click"),$(".cards").on("click",function(){Cards.length>0&&RiskGame.displayCards(e,!1,i)})},displayCards:function(e,i,t){$(".cards").off("click"),i||($(".cards-close .close").fadeIn(),$(".cards-close .close").on("click",function(){RiskGame.minimiseCards(e,t)})),$(".cards").addClass("display"),e&&$(".cards").on("click",".card",function(){var e=!1,i=$(this).data("territoryID");$.each(RiskGame.arrayOfSelectedCards,function(t,a){var r=$(a).data("territoryID");r===i&&(e=!0)}),e||($(this).addClass("selected"),RiskGame.arrayOfSelectedCards.push(this),3===RiskGame.arrayOfSelectedCards.length&&($(RiskGame.arrayOfSelectedCards).remove(),$.each(RiskGame.arrayOfSelectedCards,function(e,i){var t=$(i).data("territoryID"),a;$.each(Cards,function(e,i){t===i.territoryID&&(a=e)}),Cards.splice(a,1)}),t(),RiskGame.arrayOfSelectedCards=[]),0===Cards.length&&minimiseCards())})},minimiseCards:function(e,i){RiskGame.arrayOfSelectedCards=[],$(".cards").off("click"),$(".cards .card").removeClass("selected"),$(".cards-close .close").fadeOut(),$(".cards-close .close").off("click"),$(".cards").removeClass("display"),$(".cards").on("click",function(){Cards.length>0&&RiskGame.displayCards(e,!1,i)})},setTimer:function(e){var i=new Date(e),t=new Date,a=i.getTime()-t.getTime();$(".timer").fadeIn(),$(".timer").animate({width:"100%"},a,function(){$(".timer").css({display:"none",width:"100%"})})},initialiseGame:function(){this.hideNoPlayersText(),this.hideJoinGameButton(),this.showLeaveGameButton()},waitForReadyState:function(){this.showMapActivityIndicator()},ready:function(){this.hideMapActivityIndicator(),this.setCardsEnabled(!1)},joinGame:function(){this.initialiseGame(!0),this.hideInitialiseModal();var e=$("#ipAddressInput").val(),i=parseInt($("#portNumberInput").val());window.joinGame(e,i)},hostGame:function(){this.showHostAndPlayModal(),this.hideInitialiseModal()},hostGameOnly:function(){this.initialiseGame(),this.hideHostAndPlayModal(),this.waitForReadyState(),window.hostGame(!1)},hostAndJoinGame:function(){this.initialiseGame(!0),this.hideHostAndPlayModal(),window.hostGame(!0)},clearPlayers:function(){Players=[]},addPlayer:function(e,i,t,a){Players.push(new Player(e,i,t,a))},setMapEnabled:function(e){RiskMap.enabled=e},currentPlayerEvent:function(e,i){this.setMapEnabled(i?!0:!1),this.currentPlayer=$.grep(Players,function(i){return i.id===e?i:void 0})[0]},rejectionEvent:function(e){this.showAlert(e)},claimTerritoryEvent:function(e){RiskMap.claimTerritory(e)},distributeArmyEvent:function(e){RiskMap.distributeArmy(e)},mapUpdateEvent:function(e){RiskMap.update(e)},reinforceEvent:function(e,i){RiskMap.reinforce(e,i)},makeTurnEvent:function(e,i,t){function a(){RiskMap.setActive(!1),$(".territory").attr("class","territory"),$("#map").off("click"),$("button#makeTurn").off("click"),$("button#finishTurn").off("click"),RiskGame.hideTurnControls()}function r(){$(".territory").attr("class","territory"),$("#map").off("click"),RiskMap.makeTurn()}RiskMap.sourceTerritory=null,RiskMap.destinationTerritory=null,RiskMap.makeTurn(),this.showTurnControls(),this.setTimer(e),Cards.length>=5?RiskGame.displayCards(i,!0,function(){a(),RiskGame.minimiseCards(!1),t("TradeIn")}):this.setCardsEnabled(i,function(){a(),RiskGame.minimiseCards(!1),t("TradeIn")}),$("button#makeTurn").on("click",function(){var e=[];if(RiskMap.sourceTerritory&&e.push($(RiskMap.sourceTerritory).attr("id")),RiskMap.destinationTerritory&&e.push($(RiskMap.destinationTerritory).attr("id")),2===e.length){var i=Territories[$(RiskMap.sourceTerritory).attr("id")],n=Territories[$(RiskMap.destinationTerritory).attr("id")],o;if(i.player!==RiskGame.currentPlayer)return r(),void RiskLog.addEntry("You need to choose your own territory as the source");var s=!1;if($.each(i.neighbours,function(e,i){i.id==n.id&&(s=!0)}),!s)return r(),void RiskLog.addEntry("Choose a neighbouring territory as the destination");if(o=n.player===RiskGame.currentPlayer?!1:!0,i.armies<2)return r(),void RiskLog.addEntry("You need at least 2 armies in the source territory");a();var d;o?(d=i.armies-1,d>3&&(d=3)):d=i.armies-1,RiskGame.completeTurn(i.id,n.id,d,function(e){var a=o?"Attack":"Fortify";t(a,i.id,n.id,e)})}else RiskLog.addEntry("Please make a legal move")}),$("button#finishTurn").on("click",function(){a(),t("Quit",null,null,null)})},completeTurn:function(e,i,t,a){this.showCompleteTurn();var r,n;$.each(Territories,function(t,a){a.id===e?r=a.svg:a.id===i&&(n=a.svg)}),$(".completeTurn img#turnSource").attr("src","img/territories/"+r),$(".completeTurn img#turnDestination").attr("src","img/territories/"+n),$("#turnNumber").attr("max",t),$("#completeTurn").on("click",function(){$("#completeTurn").off("click"),RiskGame.hideCompleteTurn();var e=$("#turnNumber").val();a(e)})},defendTerritoryEvent:function(e,i,t,a){this.showDefendTerritory();var r,n;$.each(Territories,function(t,a){a.id===e?r=a.svg:a.id===i&&(n=a.svg)}),$(".defendTerritory img#defendSource").attr("src","img/territories/"+r),$(".defendTerritory img#defendDestination").attr("src","img/territories/"+n),$("#defendNumber").attr("max",t),$("#defendTerritory").on("click",function(){$("#defendTerritory").off("click"),RiskGame.hideDefendTerritory();var e=$("#defendNumber").val();a(e)})},allocateCardEvent:function(e,i){var t=new Card(e,i);Cards.push(t);var a,r;$.each(Territories,function(i,t){t.id===e&&(a=t.svg,r=i+"Card")});var n=$(".cards").append('<div class="card"><h5>'+t.type+'</h5><img src="img/territories/'+a+'"></div>');n.children().last().data("card",r),n.children().last().data("territoryID",e)},allocateArmiesEvent:function(e,i,t,a){this.showAllocateArmies();var r,n;$.each(Territories,function(t,a){a.id===e?r=a.svg:a.id===i&&(n=a.svg)}),$(".allocateArmies img#allocateSource").attr("src","img/territories/"+r),$(".allocateArmies img#allocateDestination").attr("src","img/territories/"+n),$("#allocateNumer").attr("max",t),$("#allocateArmies").on("click",function(){$("#allocateArmies").off("click"),RiskGame.hideAllocateArmies();var e=$("#allocateNumer").val();a(e)})},winnerEvent:function(e){$.each(e,function(e,i){$(".players").append("<li>"+i.name_0+"</li>")}),this.showGameOver()}};